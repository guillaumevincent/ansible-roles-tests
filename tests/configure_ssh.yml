---
- hosts: test
  become: yes
  become_user: root

  tasks:
    - name: PasswordAuthentication yes should not be present
      shell: cat /etc/ssh/sshd_config | grep '^PasswordAuthentication yes'
      register: PasswordAuthenticationYes
      failed_when: PasswordAuthenticationYes.stdout != ""

    - name: PasswordAuthentication should be set to no
      shell: cat /etc/ssh/sshd_config | grep '^PasswordAuthentication no'
      register: PasswordAuthenticationNo

    - assert:
        that: PasswordAuthenticationNo.stdout == "PasswordAuthentication no"

    - assert:
        that: PasswordAuthenticationNo.stdout_lines|length == 1
        msg: "More than one 'PasswordAuthentication no' line"

    - name: PermitRootLogin yes should not be present
      shell: cat /etc/ssh/sshd_config | grep '^PermitRootLogin yes'
      register: PermitRootLoginYes
      failed_when: PermitRootLoginYes.stdout != ""

    - name: PermitRootLogin should be set to no
      shell: cat /etc/ssh/sshd_config | grep '^PermitRootLogin no'
      register: PermitRootLoginNo

    - assert:
        that: PermitRootLoginNo.stdout == "PermitRootLogin no"

    - assert:
        that: PermitRootLoginNo.stdout_lines|length == 1
        msg: "More than one 'PermitRootLogin no' line"

